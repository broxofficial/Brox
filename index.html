<script>
  // ===== Menu =====
  const menuBtn = document.getElementById("menuBtn");
  const sideMenu = document.getElementById("sideMenu");

  menuBtn.onclick = () => {
    sideMenu.classList.toggle("open");
    menuBtn.textContent = sideMenu.classList.contains("open") ? "×" : "☰";
  };

  // غلق القائمة عند الضغط على رابط
  document.querySelectorAll(".side-menu a").forEach(link => {
    link.onclick = () => {
      sideMenu.classList.remove("open");
      menuBtn.textContent = "☰";
    };
  });

  // غلق القائمة عند الضغط خارجها
  document.addEventListener("click", e => {
    if (!sideMenu.contains(e.target) && e.target !== menuBtn) {
      sideMenu.classList.remove("open");
      menuBtn.textContent = "☰";
    }
  });

  // ===== Modal =====
  const modal = document.getElementById("myModal");
  function openModal() {
    modal.style.display = "flex";
    setTimeout(() => modal.classList.add("show"), 10);
  }

  function closeModal(event) {
    // إذا كان الضغط خارج المودال أو على الزر، يغلق المودال
    if (!event || event.target === modal || event.target.tagName === "BUTTON") {
      modal.classList.remove("show");
      setTimeout(() => (modal.style.display = "none"), 300);
    }
  }

  // ===== Chart Animation =====
  const canvas = document.getElementById("allocChart"), ctx = canvas.getContext("2d");
  const data = [99,1], colors = ["#ff4500","#333"]; let currentPercent = 0;
  function drawChart(percent){
    ctx.clearRect(0,0,250,250);
    let start=-Math.PI/2, remaining=(percent/100)*2*Math.PI;
    for(let i=0;i<data.length;i++){
      const slice=(data[i]/100)*2*Math.PI;
      const draw=Math.min(slice,remaining);
      ctx.beginPath(); ctx.moveTo(125,125);
      ctx.arc(125,125,120,start,start+draw); ctx.closePath();
      ctx.fillStyle=colors[i]; ctx.fill();
      start+=slice; remaining-=draw; if(remaining<=0) break;
    }
    ctx.beginPath(); ctx.arc(125,125,70,0,2*Math.PI); ctx.fillStyle="#141414"; ctx.fill();
    ctx.fillStyle="#fff"; ctx.font="20px Arial"; ctx.textAlign="center";
    ctx.fillText("99% / 1%",125,130);
  }
  (function animate(){ if(currentPercent<100){ currentPercent++; drawChart(currentPercent); requestAnimationFrame(animate); } })();

  // ===== Scroll Reveal =====
  function revealOnScroll(){
    document.querySelectorAll('.teaser,.step').forEach(el=>{
      if(el.getBoundingClientRect().top<window.innerHeight-50) el.classList.add('visible');
    });
  }
  window.addEventListener("scroll",revealOnScroll); revealOnScroll();

  // ===== Particles =====
  const particles = document.getElementById("particles"), ctxP = particles.getContext("2d");
  let w,h,stars=[];
  function resize(){ w=particles.width=innerWidth; h=particles.height=innerHeight; stars=[]; for(let i=0;i<100;i++){ stars.push({x:Math.random()*w, y:Math.random()*h, r:Math.random()*2.2, dx:(Math.random()-.5), dy:(Math.random()-.5)}) } }
  function draw(){ ctxP.clearRect(0,0,w,h); ctxP.fillStyle="#ff4500"; stars.forEach(s=>{ ctxP.beginPath(); ctxP.arc(s.x,s.y,s.r,0,2*Math.PI); ctxP.fill(); s.x+=s.dx; s.y+=s.dy; if(s.x<0||s.x>w)s.dx*=-1; if(s.y<0||s.y>h)s.dy*=-1; }); requestAnimationFrame(draw); }
  window.onresize=resize; resize(); draw();
</script>